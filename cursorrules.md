# 规范生成与维护规则
注意：这个文件永不修改/删除，只在下列指定的地方添加内容，并且内容严格按照以下格式，并且 composer 会自动解析这些内容，最后自动执行下列要求。同时，每次与 composer 交互时，都需要严格执行每个文件中定义的操作规范，确保所有交互都符合规则要求，该记录的必须记录，该优化的必须优化，保证每一步都得到执行。

## 1. 逻辑推理机制
### 1.1 输入解析
- 信息提取：
  * 关键词识别：提取输入中的关键信息点
  * 语义理解：理解输入的真实意图
  * 上下文关联：建立与历史信息的关联
  * 隐含信息：推断未明确表达的需求

- 约束识别：
  * 明确约束：已明确说明的限制条件
  * 隐含约束：根据上下文推断的限制
  * 领域约束：特定领域的固有规则
  * 资源约束：可用资源的限制条件

- 目标解构：
  * 主要目标：需要达成的核心目标
  * 子目标：为达成主目标的必要步骤
  * 优先级：不同目标间的优先关系
  * 完成度：目标达成的衡量标准

### 1.2 推理过程
- 知识检索：
  * 相关知识：搜索相关的知识库内容
  * 规则匹配：寻找适用的规则和模式
  * 案例参考：检索类似的历史案例
  * 最佳实践：提取可复用的解决方案

- 逻辑推导：
  * 因果分析：建立原因和结果的关联
  * 条件推理：基于条件进行逻辑推导
  * 归纳总结：从具体到一般的推理
  * 演绎分析：从一般到具体的推理

- 方案生成：
  * 方案构建：组合形成可行方案
  * 可行性：验证方案的可执行性
  * 优化空间：识别优化的可能性
  * 备选方案：准备替代解决方案

### 1.3 决策制定
- 方案评估：
  * 完整性：是否覆盖所有需求
  * 准确性：是否符合预期目标
  * 可靠性：是否具有稳定性
  * 扩展性：是否具有扩展空间

- 风险识别：
  * 执行风险：实施过程中的风险
  * 结果风险：最终结果的风险
  * 副作用：可能产生的负面影响
  * 不确定性：无法预测的因素

- 决策输出：
  * 方案选择：选定最优执行方案
  * 执行步骤：明确具体执行步骤
  * 预期结果：预期达到的效果
  * 验证方法：如何验证执行效果

### 1.4 反馈学习
- 结果分析：
  * 执行效果：实际执行的结果
  * 目标达成：目标的实现程度
  * 偏差分析：与预期的差异
  * 原因追溯：差异产生的原因

- 知识更新：
  * 规则优化：更新推理规则
  * 模式提取：提取新的模式
  * 案例存储：保存有价值案例
  * 知识扩充：补充新的知识点

- 能力提升：
  * 准确度：提高判断的准确性
  * 效率：优化处理的效率
  * 适应性：增强环境适应能力
  * 创新性：提升解决方案创新性

## 2. 文档读取与规则生成
### 2.1 文档读取顺序
- 基础读取：
  * instructions.md（必读）：
    - 首次初始化时读取
    - 规则变更时读取
    - 缓存关键信息避免重复读取

- 按需读取：
  * entities.md：
    - 涉及实体定义时读取
    - 需要实体关系时读取
    - 实体相关更新时读取

  * api.md：
    - 涉及API调用时读取
    - API变更时读取
    - 接口文档更新时读取

  * utils.md：
    - 使用工具函数时读取
    - 工具类变更时读取
    - 新增工具时读取

  * deps.md：
    - 依赖检查时读取
    - 版本更新时读取
    - 新增依赖时读取

- 读取优化：
  * 缓存机制：
    - 缓存常用信息
    - 定期更新缓存
    - 变更时清除缓存

  * 增量更新：
    - 仅读取变更部分
    - 智能合并更新
    - 保持最小读取范围

  * 预加载策略：
    - 分析任务依赖
    - 预测可能需要的文件
    - 后台异步预加载

### 2.2 规则应用机制
- 执行流程：
  1. 分析任务需求
  2. 确定所需文件
  3. 按需读取文件
  4. 执行规则动作
  5. 更新相关文件

- 规则优先级：
  * 项目特定规则 > 通用规则
  * 强制规则 > 建议规则
  * 新规则 > 旧规则
  * 手动规则 > 自动规则

- 规则冲突处理：
  * 记录冲突情况
  * 采用高优先级规则
  * 保留冲突记录
  * 等待人工确认

### 2.3 自动更新机制
- 更新触发：
  * 检测到文件变化
  * 对照规则映射
  * 执行相应更新
  * 验证更新结果

- 更新范围：
  * 仅更新规则涉及的文件
  * 仅处理规则定义的内容
  * 保持其他内容不变
  * 记录更新历史

- 异常处理：
  * 规则不存在：等待规则补充
  * 规则冲突：按优先级处理
  * 执行失败：记录错误信息
  * 更新失败：回滚更改

## 3. 文件读取与更新顺序规范
### 3.1 初始化读取顺序
- 第一步：.cursorrules（基础规则文件）
- 第二步：核心文件读取
  * .cursorrules.d/project_base/instructions.md（项目整体信息）
  * .cursorrules.d/project_base/entities.md（实体定义）
  * .cursorrules.d/project_base/api.md（接口定义）
  * .cursorrules.d/project_base/utils.md（工具定义）

### 3.2 任务执行后的更新规则
- 更新原则：
  * 保持原有文件结构不变
  * 在对应文件的相应部分追加或更新
  * 严格遵循已有格式规范
  * 确保文件一致性和完整性

- 更新映射：
  * 实体相关更新 -> entities.md
  * API相关更新 -> api.md
  * 工具类更新 -> utils.md
  * 经验教训 -> notes/lessons.md
  * 当前任务状态 -> notes/current_task.md

- 更新流程：
  1. 识别任务涉及的内容类型
  2. 定位对应的目标文件
  3. 按格式规范更新内容
  4. 验证更新后的完整性
  5. 确保文件间的关联关系正确

## 4. 内容格式规范
### 4.1 基础要求
- 编码规范：
  * 使用 UTF-8 编码
  * 使用 LF 换行符
  * 使用中文记录

- 格式规范：
  * 使用 Markdown 格式
  * 统一缩进样式
  * 保持格式一致

### 4.2 文档结构
- 文件头部：
  * 文件标题
  * 包路径说明
  * 分类目录

- 内容组织：
  * 层级结构清晰
  * 分类标记明确
  * 关联关系完整

### 4.3 更新记录
- 记录要求：
  * 记录更新时间
  * 记录更新内容
  * 记录操作人员

- 验证要求：
  * 验证记录完整性
  * 确认记录准确性
  * 保持记录一致性

### 4.4 经验教训记录
- 记录格式：
  * 标题：[日期] [错误类型]
  * 内容：
    - 错误：具体做错了什么
    - 分析：为什么会犯这个错
    - 正确：应该怎么做
    - 规则：记住什么规则
    - 关联：相关的经验教训

### 4.5 当前任务记录
- 记录格式：
  * 标题：[优先级] [状态] 任务名
  * 状态：
    - 进行：正在做
    - 暂停：临时停止
    - 取消：不做了
    - 完成：已完成
  * 内容：
    - 任务：要做什么
    - 依赖：需要先完成什么
    - 进度：做到哪了
    - 下步：接下来做什么
    - 原因：为什么暂停/取消
    - 关联：相关的任务

### 4.6 临时记录
- 记录格式：
  * 标题：[类型] 主题
  * 内容：
    - 想法：记录想到的点
    - 分析：为什么有这个想法
    - 待做：要处理的事
    - 问题：需要解决的
    - 关联：相关的记录
  * 处理：
    - 重要的转到任务
    - 已完成的删除
    - 过期的清理

## 5. Composer 交互规则
### 5.1 交互触发
- 触发时机：
  * Composer 开始回答时：
    - 读取 instructions.md
    - 分析任务需求
    - 确定所需文件
  * Composer 回答完成时：
    - 更新相关文件
    - 清理临时缓存
  * Composer 执行操作时：
    - 按需读取文件
    - 执行相关规则
  * Composer 发生错误时：
    - 读取错误处理规则
    - 执行恢复操作

### 5.2 文件处理
- 处理范围：
  * 必要文件：
    - instructions.md（基础规则）
    - current_task.md（当前任务）
  * 按需文件：
    - entities.md（涉及实体时）
    - api.md（涉及接口时）
    - utils.md（使用工具时）
    - deps.md（依赖相关时）
  * 记录文件：
    - lessons.md（错误处理时）
    - scratchpad.md（临时记录时）

- 处理方式：
  * 实时处理：交互过程中同步处理
  * 批量处理：交互结束后统一处理
  * 延迟处理：特定条件触发时处理
  * 手动处理：需要人工确认的处理

- 处理规则：
  * 变更分析：分析交互导致的变更
  * 影响评估：评估变更的影响范围
  * 更新执行：执行必要的文件更新
  * 结果验证：验证更新的正确性

### 5.3 规则执行
- 执行方式：
  * 自动执行：符合条件自动触发
  * 手动确认：需要确认后执行
  * 条件执行：满足条件时执行
  * 异步执行：后台异步处理

- 执行内容：
  * 规则检查：验证规则的适用性
  * 文件更新：更新相关文件内容
  * 关系维护：维护文件间关联
  * 记录同步：同步更新记录

- 执行验证：
  * 前置检查：执行前的条件检查
  * 过程监控：执行过程的监控
  * 结果验证：执行结果的验证
  * 回滚机制：执行失败的回滚

### 5.4 反馈处理
- 结果记录：
  * 执行日志：记录执行过程
  * 更新记录：记录更新内容
  * 错误记录：记录异常情况
  * 状态记录：记录当前状态

- 优化调整：
  * 规则优化：优化执行规则
  * 流程优化：优化执行流程
  * 效率优化：优化执行效率
  * 准确性优化：提高执行准确性

- 经验积累：
  * 问题总结：总结遇到的问题
  * 方案改进：改进解决方案
  * 规则完善：完善执行规则
  * 知识沉淀：沉淀处理经验
